%%{init: {
  'theme': 'base',
  'themeVariables': {
    'fontSize': '24px',
    'fontFamily': 'Noto Sans JP, sans-serif',
    'lineColor': '#333333',
    'primaryColor': '#f0f0f0',
    'primaryTextColor': '#1a1a1a',
    'primaryBorderColor': '#333333',
    'secondaryColor': '#e8e8e8',
    'tertiaryColor': '#ffffff',
    'nodePadding': '20',
    'nodeSpacing': '50',
    'rankSpacing': '80'
  },
  'flowchart': {
    'nodeSpacing': 60,
    'rankSpacing': 100,
    'curve': 'basis',
    'padding': 30
  }
}}%%

flowchart LR

%% â”€â”€ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph CLIENT["ã€€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€€"]
    direction TB
    BROWSER["ğŸŒ<br/><b>ãƒ–ãƒ©ã‚¦ã‚¶</b>"]
end

%% â”€â”€ DNS / ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph DNS["ã€€ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ã€€"]
    direction TB
    STARDOMAIN["ğŸ”—<br/><b>ã‚¹ã‚¿ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³</b><br/>(DNS)"]
end

%% â”€â”€ Oracle Cloud Infrastructure â”€â”€â”€â”€â”€â”€
subgraph OCI["ã€€ã€€Oracle Cloud Infrastructure (VPS / Ubuntu)ã€€ã€€"]
    direction TB
    
    subgraph WEBSERVER["Webã‚µãƒ¼ãƒå±¤"]
        direction LR
        NGINX["ğŸ”’<br/><b>nginx</b><br/>(ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·)"]
        LETSENCRYPT["ğŸ”<br/><b>Let's Encrypt</b><br/>(SSL/TLS)"]
    end
    
    subgraph APPSERVER["ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤"]
        direction TB
        PM2["âš¡<br/><b>PM2</b><br/>(ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†)"]
        
        subgraph NEXTJS["ã€€Next.js 16 App Routerã€€"]
            direction LR
            SC["<b>Server<br/>Components</b><br/>(SSR)"]
            CC["<b>Client<br/>Components</b><br/>(React)"]
            API["<b>API<br/>Routes</b><br/>(REST)"]
        end
    end
    
    subgraph DATALAYER["ãƒ‡ãƒ¼ã‚¿å±¤"]
        direction LR
        PRISMA["ğŸ“¦<br/><b>Prisma ORM</b>"]
        PG[("ğŸ—„ï¸<br/><b>PostgreSQL</b>")]
    end
end

%% â”€â”€ å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph EXTERNAL["ã€€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã€€"]
    direction TB
    AUTH["ğŸ”‘<br/><b>Auth.js</b><br/>(OAuth 2.0)"]
    SENTRY["ğŸ“Š<br/><b>Sentry</b><br/>(ã‚¨ãƒ©ãƒ¼ç›£è¦–)"]
end

%% â”€â”€ CI/CD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph CICD["ã€€CI/CDã€€"]
    direction TB
    GHA["ğŸš€<br/><b>GitHub Actions</b>"]
    TEST["ğŸ§ª<br/><b>Vitest / Playwright</b>"]
end

%% â”€â”€ æ¥ç¶šç·š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BROWSER ==>|"HTTPS"| STARDOMAIN
STARDOMAIN ==>|"DNSè§£æ±º"| NGINX
LETSENCRYPT -.->|"SSLè¨¼æ˜æ›¸"| NGINX
NGINX ==>|"ãƒ—ãƒ­ã‚­ã‚·"| PM2
PM2 ==> NEXTJS
CC <-->|"APIé€šä¿¡"| API
SC -->|"ã‚¯ã‚¨ãƒª"| PRISMA
API -->|"ã‚¯ã‚¨ãƒª"| PRISMA
PRISMA <-->|"èª­ã¿æ›¸ã"| PG
API <-->|"èªè¨¼"| AUTH
NEXTJS -.->|"ã‚¨ãƒ©ãƒ¼é€ä¿¡"| SENTRY
GHA ==>|"ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"| TEST
GHA ==>|"SSH ãƒ‡ãƒ—ãƒ­ã‚¤"| PM2

%% â”€â”€ ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
classDef clientStyle fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#0d47a1
classDef dnsStyle fill:#fff9c4,stroke:#f9a825,stroke-width:3px,color:#795548
classDef webserverStyle fill:#00897b,stroke:#004d40,stroke-width:3px,color:#ffffff
classDef appStyle fill:#7c4dff,stroke:#311b92,stroke-width:3px,color:#ffffff
classDef nextjsStyle fill:#0d47a1,stroke:#1a237e,stroke-width:3px,color:#ffffff
classDef dataStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px,color:#1b5e20
classDef externalStyle fill:#ffe0b2,stroke:#e65100,stroke-width:3px,color:#bf360c
classDef cicdStyle fill:#f3e5f5,stroke:#6a1b9a,stroke-width:3px,color:#4a148c

%% â”€â”€ ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class BROWSER clientStyle
class STARDOMAIN dnsStyle
class NGINX,LETSENCRYPT webserverStyle
class PM2 appStyle
class SC,CC,API nextjsStyle
class PRISMA,PG dataStyle
class AUTH,SENTRY externalStyle
class GHA,TEST cicdStyle
