# タグ管理画面改善 - 仕様書

## 概要

現在のタグ管理画面（`/admin`）に対して、ソート・フィルター・検索機能を大幅に強化する。

## 現状の課題

- タグ名での検索機能がない
- ソート機能がない（固定順序のみ）
- フィルターはカテゴリのみで、言語・使用数・エイリアス状態での絞り込みができない

---

## 決定事項

### 検索機能

| 項目 | 決定 | 理由 |
|------|------|------|
| 検索方式 | デバウンス付きリアルタイム（300ms） | パフォーマンスとUXのバランスが良い |
| 検索対象 | タグ名のみ | シンプルで高速。基本的な検索には十分 |

### ソート機能

| 項目 | 決定 | 理由 |
|------|------|------|
| ソート対象 | 全カラム対応 | 柔軟な並び替えが可能 |
| デフォルトソート | 使用数降順 | よく使われるタグが上に表示され実用的 |
| ソートUI | テーブルヘッダークリック | shadcn/ui Tableに親和性が高く直感的 |

### フィルター機能

| 項目 | 決定 | 理由 |
|------|------|------|
| フィルター項目 | カテゴリ + 言語 + 使用数範囲 + エイリアス状態 | タグの正規化作業に有用 |
| 使用数フィルター | 未使用(=0) / 1-10 / 11-50 / 50+ | 一般的な選択肢で色々なシーンに対応 |

### UI/UXデザイン

| 項目 | 決定 | 理由 |
|------|------|------|
| レイアウト | インライン（テーブル上に横並び） | シンプルで省スペース |
| フィルター確認 | 適用中フィルターをチップ表示 | クリックで個別解除可能。UXが良い |
| エイリアス表示 | アイコン + 背景色変更 | 行全体でエイリアスだと分かり視認性が高い |
| ローディング | スケルトンローダー | 全体がローディング中と分かりやすい |

### その他

| 項目 | 決定 | 理由 |
|------|------|------|
| URL永続化 | 検索・フィルターをURLに保存 | ブックマークや共有が可能 |
| ページネーション | 現状維持（20件/ページ） | 変更不要 |
| CSVエクスポート | 不要 | スコープを絞る |
| 一括操作 | 不要 | シンプルで安全 |

---

## 機能仕様

### 1. 検索ボックス

```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 [タグ名を検索...]              [カテゴリ▼] [言語▼] [使用数▼] [エイリアス▼] │
└─────────────────────────────────────────────────────────────┘
```

- プレースホルダー: 「タグ名を検索...」
- デバウンス: 300ms
- 部分一致検索（大文字小文字区別なし）
- 検索アイコン（虫眼鏡）を左端に配置
- クリアボタン（×）を右端に配置（入力がある場合のみ表示）

### 2. フィルター

#### カテゴリフィルター
- ドロップダウン選択
- 「すべてのカテゴリ」がデフォルト
- 各カテゴリ名の横にカラードット表示

#### 言語フィルター
- ドロップダウン選択
- 選択肢: すべて / 日本語 / 英語

#### 使用数フィルター
- ドロップダウン選択
- 選択肢:
  - すべて
  - 未使用（0件）
  - 1-10件
  - 11-50件
  - 50件以上

#### エイリアス状態フィルター
- ドロップダウン選択
- 選択肢:
  - すべて
  - エイリアスのみ
  - 正規タグのみ

### 3. 適用中フィルターチップ

```
適用中: [カテゴリ: 食品 ×] [言語: 日本語 ×] [使用数: 未使用 ×]  [すべてクリア]
```

- 適用中のフィルターを小さなチップで表示
- 各チップに×ボタンで個別解除可能
- 「すべてクリア」リンクで全フィルターをリセット
- フィルターが何も適用されていない場合は非表示

### 4. ソート

- テーブルヘッダーをクリックでソート
- クリックでトグル: なし → 昇順 → 降順 → なし
- ソート中のカラムにはアイコン表示（↑ or ↓）
- デフォルト: 使用数降順

#### ソート対象カラム
- タグ名
- カテゴリ
- 言語
- 説明
- 使用数
- 作成日（表示はなくてもソート可能にする場合は要検討）

### 5. エイリアスタグの視覚的区別

- エイリアスタグの行は薄い背景色（例: bg-muted/50）
- タグ名の横に矢印アイコン（→）を表示
- 正規タグ名をツールチップで表示

### 6. URL永続化

クエリパラメータ形式:
```
/admin?q=検索語&category=1&lang=ja&usage=0&alias=true&sort=usageCount&order=desc
```

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| q | 検索キーワード | q=りんご |
| category | カテゴリID | category=1 |
| lang | 言語 | lang=ja, lang=en |
| usage | 使用数範囲 | usage=0, usage=1-10, usage=11-50, usage=50+ |
| alias | エイリアス状態 | alias=true, alias=false |
| sort | ソート対象カラム | sort=name, sort=usageCount |
| order | ソート方向 | order=asc, order=desc |
| page | ページ番号 | page=1 |

### 7. ローディング状態

- データ取得中はテーブル部分にスケルトンローダーを表示
- 検索/フィルター変更時も同様にスケルトン表示
- フィルターコントロールは操作可能のまま

---

## 実装対象ファイル

| ファイル | 変更内容 |
|----------|----------|
| `/src/components/admin/TagList.tsx` | メイン実装（検索・フィルター・ソートUI追加） |
| `/src/app/api/admin/tags/route.ts` | API拡張（検索・フィルター・ソートパラメータ対応） |
| `/src/components/admin/TagSearchFilters.tsx` | 新規：検索・フィルターコンポーネント |
| `/src/components/admin/ActiveFilterChips.tsx` | 新規：適用中フィルターチップコンポーネント |
| `/src/hooks/useTagFilters.ts` | 新規：フィルター状態管理フック |

---

## 実装ステップ

1. **API拡張**: 検索・フィルター・ソートパラメータをAPIで受け取れるように拡張
2. **フック作成**: URL永続化を含むフィルター状態管理フックを作成
3. **検索・フィルターUI**: 検索ボックスとフィルタードロップダウンを実装
4. **フィルターチップ**: 適用中フィルターのチップ表示を実装
5. **ソート機能**: テーブルヘッダークリックでのソート機能を実装
6. **エイリアス表示**: エイリアスタグの視覚的区別を実装
7. **ローディング**: スケルトンローダーの実装
8. **テスト**: 各機能の動作確認

---

## 参考: 現在の実装

- ページ: `/src/app/admin/page.tsx`
- タグ一覧: `/src/components/admin/TagList.tsx`
- API: `/src/app/api/admin/tags/route.ts`
- UIライブラリ: shadcn/ui
