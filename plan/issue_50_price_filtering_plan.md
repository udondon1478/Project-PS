# 設計計画：価格フィルタリング機能の実装 (Issue #50)

## 目的
ユーザーが指定した価格帯で商品を検索できるようにすることで、予算に合った商品を効率的に見つけられるようにする。

## 概要
検索ページに価格帯を指定するためのスライダーを設置し、ユーザーが選択した価格帯に基づいて商品をフィルタリングして表示する機能を追加する。

## 技術選定
- フロントエンド: Next.js (AppRouter), shadcn/ui (スライダーコンポーネント), Tailwind CSS
- バックエンド: Node.js (TypeScript), Prisma (データベースクエリ)
- API: 既存の`/api/products`エンドポイントを改修

## 実装詳細

#### フロントエンド
- 検索ページのフィルターメニュー内に価格スライダーコンポーネントを配置する。
- shadcn/uiのSliderコンポーネントを利用することを検討する。
- スライダーの最小値を0円、最大値を10000円+とするUIを実装する。
- スライダーの値が変更された際に、検索クエリに価格帯のパラメータを追加する。
- 最高値が10000円+の場合、特定の値をバックエンドに送信し、10000円以上の全ての商品を取得するようにする。
- スライダーのステップ数は100円単位とするが、コード内で容易に変更可能な定数として定義する。

#### バックエンド
- `/api/products`エンドポイントに価格帯（最小価格、最大価格）を受け付けるパラメータを追加する。
- Prismaを使用して、受け取った価格帯に基づいてデータベースから商品をフィルタリングするクエリを作成する。
- 最高値が10000円+を示すパラメータを受け取った場合、価格が10000円以上の商品を検索するロジックを実装する。

### データフロー
```mermaid
graph TD
    A[ユーザー] --> B[検索ページ (Next.js)]
    B --> C[価格スライダー (shadcn/ui)]
    C --> B[検索ページ (価格帯パラメータ)]
    B --> D[APIエンドポイント /api/products]
    D --> E[バックエンドロジック (Node.js/TypeScript)]
    E --> F[Prisma クエリ]
    F --> G[PostgreSQL データベース]
    G --> F[検索結果]
    F --> E[検索結果]
    E --> D[検索結果]
    D --> B[検索結果]
    B --> A[ユーザー (フィルタリングされた商品リスト)]
```

### 開発ステップ
1.  価格スライダーコンポーネントのUI実装 (shadcn/uiを利用)
2.  検索ページへの価格スライダーの組み込みと状態管理
3.  価格帯パラメータを検索クエリに追加するロジックの実装
4.  `/api/products`エンドポイントでの価格帯パラメータの受け取りとバリデーション
5.  Prismaを使用した価格フィルタリングクエリの実装
6.  最高値10000円+の特別なフィルタリングロジックの実装
7.  フロントエンドとバックエンドの連携テスト
8.  受け入れ基準に基づいた結合テスト

### テスト項目
- 価格スライダーが正しく表示され、操作できること
- スライダーの値が検索クエリに正しく反映されること
- 最小価格、最大価格を指定して正しく商品がフィルタリングされること
- 最高値が10000円+の場合、10000円以上の全ての商品が表示されること
- スライダーのステップ数が設定通りであること
- 無効な価格帯パラメータが指定された場合の挙動